<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>เครื่องคำนวณน้ำหนักวัสดุ</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom font for better Thai display */
        body {
            font-family: 'Inter', 'Kanit', sans-serif;
            background-color: #f3f4f6;
        }
        /* Custom styles for the calculator card */
        .calculator-card {
            max-width: 600px;
            margin: 2rem auto;
            padding: 2rem;
            background-color: #ffffff;
            border-radius: 16px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .form-select, .form-input {
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            padding: 0.75rem 1rem;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            width: 100%;
            transition: border-color 0.2s;
        }
        .form-select:focus, .form-input:focus {
            outline: none;
            border-color: #3b82f6; /* Blue-500 */
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.5);
        }
        .select-wrapper {
            position: relative;
        }
        .select-wrapper::after {
            content: '▼';
            font-size: 0.75rem;
            color: #4b5563;
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            pointer-events: none;
        }
        .input-group-text {
            padding: 0.75rem 1rem;
            background-color: #e5e7eb;
            border: 1px solid #d1d5db;
            border-left: none;
            border-radius: 0 8px 8px 0;
            white-space: nowrap;
            display: flex;
            align-items: center;
        }
        .input-group .form-input {
            border-right: none;
            border-radius: 8px 0 0 8px;
        }
        .result-box {
            background-color: #f0fdf4; /* Green-50 */
            border: 1px solid #4ade80; /* Green-400 */
            color: #166534; /* Green-900 */
            padding: 1.5rem;
            border-radius: 12px;
            margin-top: 2rem;
            text-align: center;
        }
        .result-value {
            font-size: 2.25rem;
            font-weight: 700;
        }
    </style>
</head>
<body>

<div class="calculator-card">
    <header class="text-center mb-6">
        <!-- FIXED: Ensure logo path is correct. logo.png is next to index.html -->
        <img src="logo.png" alt="JUDHA Logo" class="mx-auto h-12 mb-4" onerror="this.onerror=null; this.src='https://placehold.co/150x50/3b82f6/ffffff?text=LOGO'">
        <h1 class="text-3xl font-bold text-gray-800">เครื่องคำนวณน้ำหนักวัสดุ</h1>
    </header>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
        <!-- 1. เลือกประเภทวัสดุ -->
        <div>
            <label for="materialType" class="block text-sm font-medium text-gray-700 mb-1">เลือกประเภทวัสดุ:</label>
            <div class="select-wrapper">
                <select id="materialType" class="form-select"></select>
            </div>
        </div>

        <!-- 2. เลือกเกรดวัสดุ -->
        <div>
            <label for="materialGrade" class="block text-sm font-medium text-gray-700 mb-1">เลือกเกรดวัสดุ:</label>
            <div class="select-wrapper">
                <select id="materialGrade" class="form-select"></select>
            </div>
        </div>
    </div>

    <!-- 3. เลือกรูปทรง -->
    <div class="mb-6">
        <label for="shapeType" class="block text-sm font-medium text-gray-700 mb-1">เลือกรูปทรง:</label>
        <div class="select-wrapper">
            <select id="shapeType" class="form-select"></select>
        </div>
    </div>

    <!-- Shape Visualization Area -->
    <div id="shapeDisplay" class="p-6 border border-gray-200 bg-gray-50 rounded-lg text-center mb-6">
        <!-- The JS will set the correct image path (images/hexagon.png) here -->
        <img id="shapeImage" src="" alt="รูปทรงวัสดุ" class="mx-auto h-24 object-contain mb-4" onerror="this.onerror=null; this.src='https://placehold.co/100x100/aaaaaa/ffffff?text=NO+IMAGE'">
        <p id="shapeName" class="text-lg font-semibold text-gray-600">รูปทรง</p>
    </div>

    <!-- Dimension Inputs Area -->
    <div id="dimensionInputs" class="space-y-4 mb-6">
        <!-- Dynamically generated inputs here -->
    </div>

    <div class="grid grid-cols-3 gap-4 mb-8">
        <!-- ความยาว (Length) -->
        <div class="col-span-2">
            <label for="lengthValue" class="block text-sm font-medium text-gray-700 mb-1">ความยาว:</label>
            <input type="number" id="lengthValue" class="form-input" value="1.0" min="0.001" step="0.01">
        </div>
        <div>
            <label for="lengthUnit" class="block text-sm font-medium text-gray-700 mb-1 invisible">หน่วย</label>
            <div class="select-wrapper">
                <select id="lengthUnit" class="form-select"></select>
            </div>
        </div>
    </div>

    <!-- จำนวนที่ต้องการ (Quantity) -->
    <div class="mb-6">
        <label for="quantity" class="block text-sm font-medium text-gray-700 mb-1">จำนวนที่ต้องการ:</label>
        <input type="number" id="quantity" class="form-input" value="1" min="1" step="1">
    </div>

    <!-- Calculate Button -->
    <button id="calculateButton" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-xl transition duration-150 shadow-md hover:shadow-lg">
        คำนวณ
    </button>

    <!-- Result Area -->
    <div id="resultArea" class="result-box hidden">
        <p class="text-lg font-medium">น้ำหนักรวมโดยประมาณ:</p>
        <p class="result-value"><span id="totalWeight">0.00</span> กิโลกรัม (kg)</p>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- CONSTANTS AND CONFIGURATION ---

        // CRITICAL FIX: The image path prefix MUST be correct.
        // Assuming your structure is: index.html, logo.png, images/ (folder containing all shape images)
        const IMAGE_PATH_PREFIX = 'images/';

        // Density data (kg/mm³)
        const materialData = {
            'steel-aluminum': {
                name: 'เหล็ก/อะลูมิเนียม',
                grades: {
                    'S50C': { name: 'S50C (เหล็กทั่วไป)', density: 0.00000785 }, // Standard Steel Density (7850 kg/m³ -> 0.00000785 kg/mm³)
                    'A6061': { name: 'A6061 (อะลูมิเนียม)', density: 0.00000270 }, // Standard Aluminum Density (2700 kg/m³ -> 0.00000270 kg/mm³)
                }
            }
        };

        // Shape calculation formulas (Area in mm², Mass in kg)
        const shapeData = {
            'round_bar': {
                name: 'ทรงกลมตัน (Round Bar)',
                image: 'round_bar.png',
                dims: [{ id: 'D', label: 'เส้นผ่านศูนย์กลาง (D)', defaultUnit: 'mm' }],
                formula: (dims) => {
                    const D = dims.D;
                    return (Math.PI / 4) * D * D; 
                }
            },
            'pipe': {
                name: 'ท่อกลม (Pipe)',
                image: 'pipe.png',
                dims: [
                    { id: 'OD', label: 'เส้นผ่านศูนย์กลางภายนอก (OD)', defaultUnit: 'mm' },
                    { id: 'WT', label: 'ความหนา (WT)', defaultUnit: 'mm' }
                ],
                formula: (dims) => {
                    const OD = dims.OD;
                    const WT = dims.WT;
                    const ID = OD - 2 * WT;
                    if (ID <= 0) return 0;
                    return (Math.PI / 4) * (OD * OD - ID * ID); 
                }
            },
            'square_bar': {
                name: 'สี่เหลี่ยมจัตุรัสตัน (Square Bar)',
                image: 'square_bar.png',
                dims: [{ id: 'W', label: 'ความกว้าง (W)', defaultUnit: 'mm' }],
                formula: (dims) => {
                    const W = dims.W;
                    return W * W; 
                }
            },
            'square_pipe': {
                name: 'ท่อสี่เหลี่ยมจัตุรัส (Square Pipe)',
                image: 'square_pipe.png',
                dims: [
                    { id: 'W', label: 'ความกว้าง (W)', defaultUnit: 'mm' },
                    { id: 'T', label: 'ความหนา (T)', defaultUnit: 'mm' }
                ],
                formula: (dims) => {
                    const W = dims.W;
                    const T = dims.T;
                    const innerW = W - 2 * T;
                    if (innerW <= 0) return 0;
                    return W * W - innerW * innerW; 
                }
            },
            'flat_bar': {
                name: 'สี่เหลี่ยมผืนผ้าตัน (Flat Bar)',
                image: 'flat_bar.png',
                dims: [
                    { id: 'W', label: 'ความกว้าง (W)', defaultUnit: 'mm' },
                    { id: 'H', label: 'ความสูง (H)', defaultUnit: 'mm' }
                ],
                formula: (dims) => {
                    const W = dims.W;
                    const H = dims.H;
                    return W * H; 
                }
            },
            'rectangular_pipe': {
                name: 'ท่อสี่เหลี่ยมผืนผ้า (Rectangular Pipe)',
                image: 'rectangular_pipe.png',
                dims: [
                    { id: 'W', label: 'ความกว้าง (W)', defaultUnit: 'mm' },
                    { id: 'H', label: 'ความสูง (H)', defaultUnit: 'mm' },
                    { id: 'T', label: 'ความหนา (T)', defaultUnit: 'mm' }
                ],
                formula: (dims) => {
                    const W = dims.W;
                    const H = dims.H;
                    const T = dims.T;
                    const innerW = W - 2 * T;
                    const innerH = H - 2 * T;
                    if (innerW <= 0 || innerH <= 0) return 0;
                    return (W * H) - (innerW * innerH); 
                }
            },
            'hexagon': {
                name: 'หกเหลี่ยมตัน (Hexagon)',
                image: 'hexagon.png',
                dims: [{ id: 'S', label: 'ระยะห่างระหว่างผิวเรียบ (S)', defaultUnit: 'mm' }],
                formula: (dims) => {
                    const S = dims.S;
                    return (Math.sqrt(3) / 2) * S * S; 
                }
            },
            'sheet': {
                name: 'แผ่น (Sheet/Plate)',
                image: 'sheet.png',
                dims: [
                    { id: 'W', label: 'ความกว้าง (W)', defaultUnit: 'mm' },
                    { id: 'T', label: 'ความหนา (T)', defaultUnit: 'mm' }
                ],
                // For sheet, we calculate Volume (V = W*L*T) in main logic.
                formula: (dims) => { return 1; } 
            },
             'angle': {
                name: 'ฉาก (Angle Bar)',
                image: 'angle.png',
                dims: [
                    { id: 'A', label: 'ปีกด้าน A (A)', defaultUnit: 'mm' },
                    { id: 'B', label: 'ปีกด้าน B (B)', defaultUnit: 'mm' },
                    { id: 'T', label: 'ความหนา (T)', defaultUnit: 'mm' }
                ],
                formula: (dims) => {
                    const A = dims.A;
                    const B = dims.B;
                    const T = dims.T;
                    // Area = (A * T) + ( (B - T) * T )
                    return (A * T) + (B - T) * T;
                }
            }
        };

        // Unit conversion factors (Multiplier to convert the selected unit into the BASE UNIT: mm)
        const unitConversions = {
            'mm': { text: 'มิลลิเมตร (mm.)', value: 1 },
            'cm': { text: 'เซนติเมตร (cm.)', value: 10 },
            'm': { text: 'เมตร (m.)', value: 1000 },
        };

        // --- DOM ELEMENTS ---
        const $materialType = document.getElementById('materialType');
        const $materialGrade = document.getElementById('materialGrade');
        const $shapeType = document.getElementById('shapeType');
        const $shapeImage = document.getElementById('shapeImage');
        const $shapeName = document.getElementById('shapeName');
        const $dimensionInputs = document.getElementById('dimensionInputs');
        const $lengthValue = document.getElementById('lengthValue');
        const $lengthUnit = document.getElementById('lengthUnit');
        const $quantity = document.getElementById('quantity');
        const $calculateButton = document.getElementById('calculateButton');
        const $totalWeight = document.getElementById('totalWeight');
        const $resultArea = document.getElementById('resultArea');


        // --- HELPER FUNCTIONS ---

        /**
         * Populates a select element with options from a data object.
         */
        function populateSelect(selectElement, dataObject, defaultValueKey) {
            selectElement.innerHTML = '';
            for (const key in dataObject) {
                const option = document.createElement('option');
                option.value = key;
                const displayName = dataObject[key].text || dataObject[key].name;
                option.textContent = displayName;
                if (key === defaultValueKey) {
                    option.selected = true;
                }
                selectElement.appendChild(option);
            }
        }

        /**
         * Renders the dynamic input fields based on the selected shape and updates the image.
         */
        function renderDimensionInputs() {
            const selectedShapeKey = $shapeType.value;
            const shape = shapeData[selectedShapeKey];
            $dimensionInputs.innerHTML = '';
            
            // FIX: Ensure the image source is correctly constructed using the prefix
            $shapeImage.src = IMAGE_PATH_PREFIX + shape.image;
            $shapeName.textContent = shape.name;

            shape.dims.forEach(dim => {
                const unitKey = dim.defaultUnit || 'mm'; 
                const unitText = unitConversions[unitKey].text;

                const html = `
                    <div>
                        <label for="dim_${dim.id}" class="block text-sm font-medium text-gray-700 mb-1">${dim.label}:</label>
                        <div class="flex">
                            <input type="number" id="dim_${dim.id}" 
                                   class="form-input" 
                                   value="10.0" min="0.001" step="0.01" 
                                   data-unit="${unitKey}"
                                   placeholder="หน่วย: ${unitText}">
                            <div class="input-group-text">${unitText}</div>
                        </div>
                    </div>
                `;
                $dimensionInputs.insertAdjacentHTML('beforeend', html);
            });
            
            // Re-attach event listeners to the newly created inputs
            $dimensionInputs.querySelectorAll('input').forEach(input => {
                input.addEventListener('input', calculateWeight);
            });

            // Re-calculate the weight whenever dimensions change
            calculateWeight();
        }

        /**
         * Calculates the total weight based on current selections and inputs.
         */
        function calculateWeight() {
            // Get selected material density
            const gradeKey = $materialGrade.value;
            const materialTypeKey = $materialType.value;
            const density = materialData[materialTypeKey]?.grades[gradeKey]?.density;
            
            if (!density) {
                $resultArea.classList.add('hidden');
                return;
            }

            const selectedShapeKey = $shapeType.value;
            const shape = shapeData[selectedShapeKey];

            // 1. Get Dimension Inputs (W, H, D, etc.) and ensure they are valid
            const dimValues = {};
            let allDimsValid = true;

            shape.dims.forEach(dim => {
                const inputElement = document.getElementById(`dim_${dim.id}`);
                const value = parseFloat(inputElement ? inputElement.value : '0');
                
                if (isNaN(value) || value <= 0) {
                    allDimsValid = false;
                }
                
                // Dimensions are taken directly in mm (based on the current input rendering)
                dimValues[dim.id] = value; 
            });

            if (!allDimsValid) {
                $totalWeight.textContent = '0.00';
                $resultArea.classList.remove('hidden');
                return; 
            }

            // 2. Get Length and convert to mm
            const lengthUnitKey = $lengthUnit.value;
            const lengthMultiplier = unitConversions[lengthUnitKey].value;
            const lengthValue = parseFloat($lengthValue.value) || 0;
            const totalLength_mm = lengthValue * lengthMultiplier;

            if (totalLength_mm <= 0) {
                $totalWeight.textContent = '0.00';
                $resultArea.classList.remove('hidden');
                return;
            }

            // 3. Get Quantity
            const quantity = parseInt($quantity.value) || 1;

            let volume_mm3 = 0; 

            if (selectedShapeKey === 'sheet') {
                // Special case: Sheet uses W, T from dims, and totalLength_mm for L
                const W = dimValues.W || 0;
                const T = dimValues.T || 0; 
                volume_mm3 = W * totalLength_mm * T; 
            } else {
                // Standard case: Calculate Cross-Sectional Area (mm²)
                const crossSectionalArea_mm2 = shape.formula(dimValues);
                
                if (crossSectionalArea_mm2 <= 0) {
                    $totalWeight.textContent = '0.00';
                    $resultArea.classList.remove('hidden');
                    return;
                }
                
                // Volume = Area * Length
                volume_mm3 = crossSectionalArea_mm2 * totalLength_mm;
            }

            // 4. Calculate Weight
            // Weight (kg) = Volume (mm³) * Density (kg/mm³)
            const singleWeight = volume_mm3 * density;
            const totalWeight = singleWeight * quantity;

            // 5. Display Result
            $totalWeight.textContent = totalWeight.toFixed(2);
            $resultArea.classList.remove('hidden');
        }

        // --- INITIALIZATION AND EVENT LISTENERS ---

        function init() {
            // 1. Populate Material Type (Default: steel-aluminum)
            populateSelect($materialType, materialData, 'steel-aluminum');
            
            // 2. Populate Material Grade (Default: S50C)
            const defaultMaterialKey = $materialType.value;
            populateSelect($materialGrade, materialData[defaultMaterialKey].grades, 'S50C');

            // 3. Populate Shape Type (Default: hexagon)
            populateSelect($shapeType, shapeData, 'hexagon'); 

            // 4. Populate Length Unit (Default: m)
            populateSelect($lengthUnit, unitConversions, 'm'); 
            
            // 5. Render initial dimensions for the default shape
            renderDimensionInputs();

            // Attach core event listeners
            $materialType.addEventListener('change', () => {
                const newMaterialKey = $materialType.value;
                populateSelect($materialGrade, materialData[newMaterialKey].grades, Object.keys(materialData[newMaterialKey].grades)[0]);
                calculateWeight();
            });

            $materialGrade.addEventListener('change', calculateWeight);
            $shapeType.addEventListener('change', renderDimensionInputs); 
            $lengthValue.addEventListener('input', calculateWeight);
            $lengthUnit.addEventListener('change', calculateWeight);
            $quantity.addEventListener('input', calculateWeight);
            
            $calculateButton.addEventListener('click', calculateWeight);

            calculateWeight();
        }

        // Run the initialization function
        init();
    });
</script>
